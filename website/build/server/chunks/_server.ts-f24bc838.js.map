{"version":3,"file":"_server.ts-f24bc838.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/auth/login/_server.ts.js"],"sourcesContent":["import { p as prisma } from \"../../../../../chunks/prisma.js\";\nimport { e as error, j as json } from \"../../../../../chunks/index.js\";\nimport { c as comparePassword } from \"../../../../../chunks/index4.js\";\nconst POST = async ({ locals, request }) => {\n  const { username, password } = await request.json();\n  const user = await prisma.user.findUnique({\n    where: { username },\n    include: {\n      roles: true\n    }\n  });\n  if (!user) {\n    throw error(401, \"Invalid username or password\");\n  }\n  const passwordMatch = await comparePassword(password, user.password);\n  if (!passwordMatch) {\n    throw error(401, \"Invalid username or password\");\n  }\n  await prisma.session.deleteMany({\n    where: {\n      userId: user.uid\n    }\n  });\n  const session = await prisma.session.create({\n    data: {\n      userId: user.uid\n    }\n  });\n  locals.user = {\n    isActive: user.isActive,\n    roles: user.roles,\n    uid: user.uid,\n    username: user.username,\n    isDeleted: user.isDeleted\n  };\n  return json(\n    {\n      user: locals.user\n    },\n    {\n      headers: {\n        \"Set-Cookie\": `session=${session.uid}; HttpOnly; Path=/; SameSite=Lax;`\n      }\n    }\n  );\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":";;;;;;AAGK,MAAC,IAAI,GAAG,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK;AAC5C,EAAE,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;AACtD,EAAE,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC;AAC5C,IAAI,KAAK,EAAE,EAAE,QAAQ,EAAE;AACvB,IAAI,OAAO,EAAE;AACb,MAAM,KAAK,EAAE,IAAI;AACjB,KAAK;AACL,GAAG,CAAC,CAAC;AACL,EAAE,IAAI,CAAC,IAAI,EAAE;AACb,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,8BAA8B,CAAC,CAAC;AACrD,GAAG;AACH,EAAE,MAAM,aAAa,GAAG,MAAM,eAAe,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;AACvE,EAAE,IAAI,CAAC,aAAa,EAAE;AACtB,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,8BAA8B,CAAC,CAAC;AACrD,GAAG;AACH,EAAE,MAAM,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC;AAClC,IAAI,KAAK,EAAE;AACX,MAAM,MAAM,EAAE,IAAI,CAAC,GAAG;AACtB,KAAK;AACL,GAAG,CAAC,CAAC;AACL,EAAE,MAAM,OAAO,GAAG,MAAM,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC;AAC9C,IAAI,IAAI,EAAE;AACV,MAAM,MAAM,EAAE,IAAI,CAAC,GAAG;AACtB,KAAK;AACL,GAAG,CAAC,CAAC;AACL,EAAE,MAAM,CAAC,IAAI,GAAG;AAChB,IAAI,QAAQ,EAAE,IAAI,CAAC,QAAQ;AAC3B,IAAI,KAAK,EAAE,IAAI,CAAC,KAAK;AACrB,IAAI,GAAG,EAAE,IAAI,CAAC,GAAG;AACjB,IAAI,QAAQ,EAAE,IAAI,CAAC,QAAQ;AAC3B,IAAI,SAAS,EAAE,IAAI,CAAC,SAAS;AAC7B,GAAG,CAAC;AACJ,EAAE,OAAO,IAAI;AACb,IAAI;AACJ,MAAM,IAAI,EAAE,MAAM,CAAC,IAAI;AACvB,KAAK;AACL,IAAI;AACJ,MAAM,OAAO,EAAE;AACf,QAAQ,YAAY,EAAE,CAAC,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,iCAAiC,CAAC;AAC/E,OAAO;AACP,KAAK;AACL,GAAG,CAAC;AACJ;;;;"}